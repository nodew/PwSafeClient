<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PwSafeClient.Maui.Pages.UnlockPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:PwSafeClient.Maui.ViewModels"
    x:DataType="viewModels:UnlockViewModel"
    Title="Unlock"
    Shell.NavBarIsVisible="False"
    BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">

    <Grid RowDefinitions="Auto, *, Auto" Padding="24" RowSpacing="10">

        <!-- Top Bar -->
        <Grid Grid.Row="0" ColumnDefinitions="*, Auto">
            <Label Grid.Column="1"
                   Text="Switch Database"
                   TextColor="{StaticResource Primary}"
                   FontSize="14"
                   FontAttributes="Semibold">
                <Label.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SwitchDatabaseCommand}" />
                </Label.GestureRecognizers>
            </Label>
        </Grid>

        <!-- Center Content -->
        <VerticalStackLayout Grid.Row="1" VerticalOptions="Center" Spacing="24">

            <!-- Lock Icon -->
            <Border HeightRequest="80" WidthRequest="80" BackgroundColor="{StaticResource Primary}" StrokeShape="RoundRectangle 20" StrokeThickness="0" HorizontalOptions="Center">
                <Label Text="&#xe90d;" FontFamily="IconFont" FontSize="40" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" />
            </Border>

            <VerticalStackLayout Spacing="8">
                <Label Text="Welcome Back" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{AppThemeBinding Light={StaticResource TextMainLight}, Dark={StaticResource TextMainDark}}" />

                <!-- Database Name -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                        Stroke="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 999"
                        Padding="10,4"
                        HorizontalOptions="Center">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding SwitchDatabaseCommand}" />
                    </Border.GestureRecognizers>
                    <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                        <Label Text="&#xe90a;" FontFamily="IconFont" FontSize="16" TextColor="{StaticResource Primary}" VerticalOptions="Center" />
                        <Label Text="{Binding DisplayName}" FontSize="13" TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}" VerticalOptions="Center" />
                    </HorizontalStackLayout>
                </Border>
            </VerticalStackLayout>

            <!-- Password Entry Section -->
            <VerticalStackLayout Spacing="16">
                <Label Text="Enter your master password to decrypt and access your safe."
                       FontSize="13"
                       TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
                       HorizontalTextAlignment="Center" />

                <!-- Password Input -->
                <Border StrokeShape="RoundRectangle 12"
                        StrokeThickness="1"
                        Stroke="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}"
                        BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                        Padding="12,0">
                    <Grid ColumnDefinitions="Auto, *, Auto">
                        <Label Grid.Column="0" Text="&#xe90c;" FontFamily="IconFont" FontSize="20" TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray400}}" VerticalOptions="Center" Margin="0,0,8,0" />

                        <Entry Grid.Column="1"
                               Placeholder="Master Password"
                               IsPassword="{Binding IsPasswordHidden}"
                               Text="{Binding Password}"
                               TextColor="{AppThemeBinding Light={StaticResource TextMainLight}, Dark={StaticResource TextMainDark}}"
                               BackgroundColor="Transparent"
                               VerticalOptions="Center" />

                        <Label Grid.Column="2"
                               Text="{Binding PasswordIcon}"
                               FontFamily="IconFont"
                               FontSize="24"
                               TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray400}}"
                               VerticalOptions="Center">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding TogglePasswordVisibilityCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                    </Grid>
                </Border>

                <!-- Read Only Checkbox -->
                <Label Text="{Binding ErrorMessage}"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotNullOrWhiteSpaceConverter}}"
                       TextColor="{StaticResource Error}"
                       FontSize="12"
                       HorizontalOptions="Center" />

                <!-- Buttons -->
                <Grid ColumnDefinitions="*, Auto" ColumnSpacing="12">
                    <Button Grid.Column="0"
                            Text="Unlock Safe"
                            Command="{Binding UnlockCommand}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            CornerRadius="12"
                            HeightRequest="52"
                            FontAttributes="Bold"/>

                    <Button Grid.Column="1"
                            Command="{Binding BiometricUnlockCommand}"
                            IsVisible="{Binding IsBiometricUnlockVisible}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                            TextColor="{AppThemeBinding Light={StaticResource TextMainLight}, Dark={StaticResource TextMainDark}}"
                            BorderColor="{AppThemeBinding Light={StaticResource BorderLight}, Dark={StaticResource BorderDark}}"
                            BorderWidth="1"
                            CornerRadius="12"
                            HeightRequest="52"
                            WidthRequest="52"
                            Padding="0"
                            FontFamily="IconFont"
                            FontSize="24"
                            Text="&#xe909;">
                    </Button>
                </Grid>
            </VerticalStackLayout>

        </VerticalStackLayout>

        <!-- Footer -->
        <Label Grid.Row="2"
               Text="Forgot Master Password?"
               TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
               FontSize="14"
               HorizontalOptions="Center"
               Margin="0,0,0,20">
            <Label.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding ForgotPasswordCommand}" />
            </Label.GestureRecognizers>
        </Label>

    </Grid>
</ContentPage>
